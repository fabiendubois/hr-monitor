<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HR Monitor Pro</title>
    <link rel="stylesheet" href="style.css">
    <!-- Chart.js from CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Workout Library -->
    <!-- Removed duplicate script -->
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
</head>

<body>
    <div class="container">
        <header>
            <div class="header-content">
                <h1>HR MONITOR <span class="pro-badge">PRO</span></h1>
                <div class="header-controls">
                    <button id="connectBtn" class="btn-connect">
                        <span class="status-dot" id="hrStatusDot"></span>
                        <span class="icon">‚ù§Ô∏è</span> HR
                    </button>
                    <button id="connectTrainerBtn" class="btn-connect btn-trainer">
                        <span class="status-dot" id="trainerStatusDot"></span>
                        <span class="icon">üö¥</span> TRAINER
                    </button>
                    <button id="demoBtn" class="btn-connect btn-demo">
                        <span class="icon">üéÆ</span> DEMO
                    </button>
                    <button id="workoutsBtn" class="btn-connect btn-workout">
                        <span class="icon">üìã</span> ENTRA√éNEMENTS
                    </button>
                    <button id="settingsBtn" class="btn-icon" title="Param√®tres Strava">‚öôÔ∏è</button>
                    <button id="debugBtn" class="btn-icon" title="Mode Debug (Time Warp)">‚ö°Ô∏è</button>
                </div>
            </div>
        </header>

        <main>

            <div class="dashboard">
                <!-- Workout HUD (Hidden by default) -->
                <div id="workoutHud" class="card workout-hud hidden">
                    <div class="hud-header">
                        <h2 id="workoutName">Nom de l'entra√Ænement</h2>
                        <span id="workoutTotalTime">00:00 / 00:00</span>
                    </div>
                    <div class="hud-progress">
                        <div class="progress-bar">
                            <div id="workoutProgressBar" class="progress-fill" style="width: 0%"></div>
                        </div>
                        <div class="profile-chart-container">
                            <canvas id="workoutProfileChart"></canvas>
                        </div>
                    </div>
                    <div class="hud-interval">
                        <div class="interval-info">
                            <span class="interval-label">INTERVALLE</span>
                            <span id="intervalName" class="interval-name">--</span>
                        </div>
                        <div class="interval-timer">
                            <span id="intervalTimeRemaining">00:00</span>
                        </div>
                        <div class="interval-next">
                            <span class="next-label">SUIVANT:</span>
                            <span id="nextIntervalName">--</span>
                        </div>
                    </div>
                </div>

                <!-- Row 1: Activity & Trainer -->
                <div class="dashboard-row">
                    <!-- Activity Controls & Timer -->
                    <div class="card activity-panel">
                        <div id="timerDisplay" class="timer">00:00:00</div>
                        <div class="controls">
                            <button id="startBtn" class="btn-control btn-start">‚ñ∂ D√âMARRER</button>
                            <button id="pauseBtn" class="btn-control btn-pause hidden">‚è∏ PAUSE</button>
                            <button id="stopBtn" class="btn-control btn-stop hidden">‚èπ STOP & SAVE</button>
                        </div>
                    </div>

                    <!-- Trainer Control Panel -->
                    <div class="card control-panel" id="trainerControlPanel">
                        <h2 class="metric-title">CONTR√îLE TRAINER</h2>

                        <!-- ERG Control Row -->
                        <div class="trainer-property">
                            <span class="property-label">ERG</span>
                            <div class="property-controls">
                                <button id="decreasePowerBtn" class="btn-adjust">-</button>
                                <div class="target-display">
                                    <span id="targetPowerDisplay">150</span>
                                    <span class="unit">W</span>
                                </div>
                                <button id="increasePowerBtn" class="btn-adjust">+</button>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="setPowerBtn">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Row 2: Power & HR -->
                <div class="dashboard-row">
                    <!-- Power Block -->
                    <div class="card metric-block">
                        <h2 class="metric-title">PUISSANCE</h2>
                        <div class="metric-current">
                            <span id="power" class="value-large">--</span>
                            <span class="unit-large">WATTS</span>
                        </div>
                        <div class="zone-indicator" id="powerZoneIndicator">ZONE --</div>
                        <div class="target-indicator hidden" id="powerTargetContainer">
                            CIBLE: <span id="powerTargetValue" class="target-value">--</span> W
                        </div>
                        <div class="metric-stats">
                            <div class="stat-item">
                                <span class="stat-label">MIN</span>
                                <span id="minPower" class="stat-value">--</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">MAX</span>
                                <span id="maxPower" class="stat-value">--</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">MOY</span>
                                <span id="avgPower" class="stat-value">--</span>
                            </div>
                        </div>
                        <div class="metric-chart">
                            <canvas id="powerChart"></canvas>
                        </div>
                    </div>

                    <!-- HR Block -->
                    <div class="card metric-block">
                        <h2 class="metric-title">FR√âQUENCE CARDIAQUE</h2>
                        <div class="metric-current">
                            <span id="heartRate" class="value-large">--</span>
                            <span class="unit-large">BPM</span>
                        </div>
                        <div class="zone-indicator" id="zoneIndicator">ZONE --</div>
                        <div class="metric-stats">
                            <div class="stat-item">
                                <span class="stat-label">MIN</span>
                                <span id="minHr" class="stat-value">--</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">MAX</span>
                                <span id="maxHr" class="stat-value">--</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">MOY</span>
                                <span id="avgHr" class="stat-value">--</span>
                            </div>
                        </div>
                        <div class="metric-chart">
                            <canvas id="hrChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Row 3: Speed & Cadence -->
                <div class="dashboard-row">
                    <!-- Speed Block -->
                    <div class="card metric-block">
                        <h2 class="metric-title">VITESSE</h2>
                        <div class="metric-current">
                            <span id="speed" class="value-large">--</span>
                            <span class="unit-large">KM/H</span>
                        </div>
                        <div class="metric-stats">
                            <div class="stat-item">
                                <span class="stat-label">MIN</span>
                                <span id="minSpeed" class="stat-value">--</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">MAX</span>
                                <span id="maxSpeed" class="stat-value">--</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">MOY</span>
                                <span id="avgSpeed" class="stat-value">--</span>
                            </div>
                        </div>
                        <div class="metric-chart">
                            <canvas id="speedChart"></canvas>
                        </div>
                    </div>

                    <!-- Cadence Block -->
                    <div class="card metric-block">
                        <h2 class="metric-title">CADENCE</h2>
                        <div class="metric-current">
                            <span id="cadence" class="value-large">--</span>
                            <span class="unit-large">RPM</span>
                        </div>
                        <div class="metric-stats">
                            <div class="stat-item">
                                <span class="stat-label">MIN</span>
                                <span id="minCadence" class="stat-value">--</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">MAX</span>
                                <span id="maxCadence" class="stat-value">--</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">MOY</span>
                                <span id="avgCadence" class="stat-value">--</span>
                            </div>
                        </div>
                        <div class="metric-chart">
                            <canvas id="cadenceChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Settings Modal -->
        <div id="settingsModal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Param√®tres Strava</h2>
                    <span id="closeSettings" class="close">&times;</span>
                </div>
                <p class="info-text">Pour uploader sur Strava, vous devez fournir vos propres cl√©s API (disponibles sur
                    <a href="https://www.strava.com/settings/api" target="_blank">strava.com/settings/api</a>).
                </p>

                <div class="form-group">
                    <label for="clientId">Client ID</label>
                    <input type="text" id="clientId" placeholder="ex: 12345">
                </div>

                <div class="form-group">
                    <label for="clientSecret">Client Secret</label>
                    <input type="password" id="clientSecret" placeholder="ex: a1b2c3d4...">
                </div>

                <div class="form-group">
                    <label for="userFtp">Votre FTP (Watts)</label>
                    <input type="number" id="userFtp" placeholder="ex: 250" value="220">
                </div>

                <div class="form-actions">
                    <button id="saveSettingsBtn" class="btn-primary">Sauvegarder</button>
                    <button id="stravaAuthBtn" class="btn-strava hidden">Connecter Strava</button>
                </div>
                <p id="authStatus" class="status-text"></p>
            </div>
        </div>

        <!-- Workout Selection Modal -->
        <div id="workoutModal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Choisir un entra√Ænement</h2>
                    <span id="closeWorkoutModal" class="close">&times;</span>
                </div>
                <div id="workoutList" class="workout-list">
                    <!-- Workouts will be injected here -->
                </div>
            </div>
        </div>

        <!-- Debug Panel -->
        <div id="debugPanel" class="debug-panel hidden">
            <h3>Time Warp ‚ö°Ô∏è</h3>
            <div class="debug-controls">
                <button class="btn-debug active" data-speed="1">x1</button>
                <button class="btn-debug" data-speed="10">x10</button>
                <button class="btn-debug" data-speed="60">x60</button>
            </div>
        </div>

        <!-- Save Activity Modal -->
        <div id="saveModal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Sauvegarder l'activit√©</h2>
                    <span id="closeSaveModal" class="close">&times;</span>
                </div>

                <div class="activity-summary">
                    <div class="summary-item">
                        <span class="summary-label">DUR√âE</span>
                        <span id="summaryDuration" class="summary-value">00:00:00</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">FC MOY</span>
                        <span id="summaryAvgHr" class="summary-value">--</span>
                        <span class="summary-unit">BPM</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">PUISSANCE MOY</span>
                        <span id="summaryAvgPower" class="summary-value">--</span>
                        <span class="summary-unit">W</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">VITESSE MOY</span>
                        <span id="summaryAvgSpeed" class="summary-value">--</span>
                        <span class="summary-unit">KM/H</span>
                    </div>
                </div>

                <p class="info-text">Choisissez comment sauvegarder votre session :</p>

                <div class="save-options">
                    <button id="uploadStravaBtn" class="btn-save-option">
                        <span class="save-icon">üö¥</span>
                        <span class="save-label">Upload Strava</span>
                    </button>
                    <button id="downloadTcxBtn" class="btn-save-option">
                        <span class="save-icon">üì•</span>
                        <span class="save-label">T√©l√©charger TCX</span>
                    </button>
                </div>

                <button id="cancelSaveBtn" class="btn-cancel">Annuler</button>
            </div>
        </div>

        <footer>
            <p>‚ö†Ô∏è Compatible uniquement avec <strong>Google Chrome</strong>, Edge et Opera.</p>
        </footer>
    </div>
    <script src="workouts.js"></script>
    <script src="utils.js"></script>
    <script src="app.js"></script>
</body>

</html>